(()=>{"use strict";function e(e,o){Array.from(e.querySelectorAll(o.inputSelector)).forEach((function(n){t(e,n,o)})),n(e,o)}function t(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".popup__".concat(t.name,"_input-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".popup__".concat(t.name,"_input-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}function n(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);!function(e){return e.some((function(e){return!e.validity.valid}))}(n)?(o.disabled=!1,o.classList.remove(t.inactiveButtonClass)):(o.disabled=!0,o.classList.add(t.inactiveButtonClass))}function o(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&i(t)}}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function i(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function a(e,t,n,o){var r=e.name||"Бермудский треугольник",i=e.link||"#",a=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),c=a.querySelector(".card__image"),u=a.querySelector(".card__title"),l=a.querySelector(".card__delete-button"),s=a.querySelector(".card__like-button"),d=a.querySelector(".card__like-number");return u.textContent=r,n?l.addEventListener("click",(function(t){n(a,e._id)})):l.classList.add("card__delete-button_disabled"),s.addEventListener("click",(function(t){o(a,e._id)})),d.textContent=0,c.src=i,c.alt=r,c.addEventListener("click",(function(e){t(c.src,c.alt,u.textContent)})),a}function c(e,t,n){var o=e.querySelector(".card__like-button"),r=e.querySelector(".card__like-number");t.likes.find((function(e){return e._id===n}))?o.classList.add("card__like-button_is-active"):o.classList.remove("card__like-button_is-active"),r.textContent=t.likes.length}var u="https://nomoreparties.co/v1/wff-cohort-33/users/me",l="https://nomoreparties.co/v1/wff-cohort-33/cards",s={authorization:"5c2cc4ae-2520-4cde-8c38-e0754b178a69","Content-Type":"application/json"};function d(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function p(e){console.log(e)}var f=document.querySelector(".content"),m=f.querySelector(".places__list"),_=f.querySelector(".profile__edit-button"),v=f.querySelector(".profile__add-button"),y=(f.querySelector(".profile__id"),f.querySelector(".profile__title")),h=f.querySelector(".profile__description"),b=f.querySelector(".profile__image"),S=document.querySelector(".popup_type_edit"),C=document.querySelector(".popup_type_edit-avatar"),q=document.querySelector(".popup_type_new-card"),L=document.querySelector(".popup_type_delete-card"),k=document.querySelector(".popup_type_image"),E=k.querySelector(".popup__image"),g=k.querySelector(".popup__caption"),x=document.forms["edit-profile"],A=document.forms["edit-avatar"],T=document.forms["remove-place"],w=document.forms["new-place"],D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function I(e,t,n){E.src=e,E.alt=t,g.textContent=n,r(k)}function P(e,t){(function(e,t){return fetch(l+"/likes/"+e,{method:t?"PUT":"DELETE",headers:s}).then(d)})(t,!function(e){return null!==e.querySelector(".card__like-button_is-active")}(e)).then((function(t){return c(e,t,profileId)})).catch(p)}var B,N=null;function O(e,t){N={Card:e,CardId:t},r(L)}document.addEventListener("click",(function(e){e.target.classList.contains("popup__close")?i(e.target.closest(".popup")):e.target.classList.contains("popup")&&i(e.target)})),_.addEventListener("click",(function(){x.reset(),x.elements.name.value=y.textContent,x.elements.description.value=h.textContent,e(x,D),r(S)})),b.addEventListener("click",(function(){A.reset();var t=b.style["background-image"];/^URL\([\"\'].+[\"\']\)$/i.test(t)&&(A.elements.link.value=t.slice(5,t.length-2)),e(A,D),r(C)})),v.addEventListener("click",(function(){w.reset(),e(w,D),r(q)})),x.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=x.submit.textContent;x.submit.textContent=x.submit.dataset.operation,(t=x.elements.name.value,n=x.elements.description.value,fetch(u,{method:"PATCH",headers:s,body:JSON.stringify({name:t,about:n})}).then(d)).then((function(e){y.textContent=e.name,h.textContent=e.about,i(S)})).catch(p).finally((function(){x.submit.textContent=o}))})),A.addEventListener("submit",(function(e){e.preventDefault();var t,n=A.submit.textContent;A.submit.textContent=A.submit.dataset.operation,(t=A.elements.link.value,fetch(u+"/avatar",{method:"PATCH",headers:s,body:JSON.stringify({avatar:t})}).then(d)).then((function(e){b.style["background-image"]='url("'+e.avatar+'")',i(C)})).catch(p).finally((function(){A.submit.textContent=n}))})),T.addEventListener("submit",(function(e){if(e.preventDefault(),N){var t=N.CardId,n=T.submit.textContent;T.submit.textContent=T.submit.dataset.operation,function(e){return fetch(l+"/"+e,{method:"DELETE",headers:s}).then(d)}(t).then((function(){N&&(N.Card.remove(),N=null),i(L)})).catch(p).finally((function(){T.submit.textContent=n}))}})),w.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=w.submit.textContent;w.submit.textContent=w.submit.dataset.operation,(t=w.elements["place-name"].value,n=w.elements.link.value,fetch(l,{method:"POST",headers:s,body:JSON.stringify({name:t,link:n})}).then(d)).then((function(e){var t=a(e,I,O,P);m.prepend(t),i(q)})).catch(p).finally((function(){w.submit.textContent=o}))})),B=D,Array.from(document.querySelectorAll(B.formSelector)).forEach((function(e){return function(e,o){Array.from(e.querySelectorAll(o.inputSelector)).forEach((function(e){e.addEventListener("input",(function(e){var r=e.target.closest(o.formSelector);t(r,e.currentTarget,o),n(r,o)}))}))}(e,B)})),Promise.all([fetch(u,{headers:s}).then(d).then((function(e){globalThis.profileId=e._id,y.textContent=e.name,h.textContent=e.about,b.style["background-image"]="url(".concat(e.avatar,")")})),fetch(l,{headers:s}).then(d)]).then((function(e){e[1].forEach((function(e){return c(n=a(t=e,I,profileId===t.owner._id?O:null,P),t,profileId),void m.append(n);var t,n}))})).catch(p)})();