(()=>{"use strict";function t(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&n(e)}}function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",t)}function n(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",t);var n=new Event("closePopup",{bubbles:!0});e.dispatchEvent(n)}function r(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(t,e,n){var r=t.querySelector(".popup__".concat(e.name,"_input-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(t,e,n):function(t,e,n,r){var o=t.querySelector(".popup__".concat(e.name,"_input-error"));e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(t,e,e.validationMessage,n)}function o(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);!function(t){return t.some((function(t){return!t.validity.valid}))}(n)?(r.disabled=!1,r.classList.remove(e.inactiveButtonClass)):(r.disabled=!0,r.classList.add(e.inactiveButtonClass))}function a(t){var e=t.target.closest(".popup__is-validating"),n=i(e),a=e.querySelector(n.formSelector);r(a,t.currentTarget,n),o(a,n)}function i(t){return{formSelector:t.dataset.validationFormSelector,inputSelector:t.dataset.validationInputSelector,submitButtonSelector:t.dataset.validationSubmitButtonSelector,inactiveButtonClass:t.dataset.validationInactiveButtonClass,inputErrorClass:t.dataset.validationInputErrorClass,errorClass:t.dataset.validationErrorClass}}function c(t,e,n,r){var o=t.name||"Бермудский треугольник",a=t.link||"#",i=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),c=i.querySelector(".card__id"),u=i.querySelector(".card__image"),l=i.querySelector(".card__title"),s=i.querySelector(".card__delete-button"),d=i.querySelector(".card__like-button");return c.textContent=t._id,l.textContent=o,n?s.addEventListener("click",n):s.classList.add("card__delete-button_disabled"),d.addEventListener("click",r),u.src=a,u.alt=o,u.addEventListener("click",e),i}function u(t){return t.querySelector(".card__id").textContent}function l(t,e,n){var r=t.querySelector(".card__like-button"),o=t.querySelector(".card__like-number");e.likes.find((function(t){return t._id===n}))?r.classList.add("card__like-button_is-active"):r.classList.remove("card__like-button_is-active"),o.textContent=e.likes.length}var s="https://nomoreparties.co/v1/wff-cohort-33/users/me",d="https://nomoreparties.co/v1/wff-cohort-33/cards",p={authorization:"5c2cc4ae-2520-4cde-8c38-e0754b178a69","Content-Type":"application/json"};function v(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}function m(t){console.log(t)}function f(t){return fetch(d,{headers:p}).then(v).then(t).catch(m)}var _,y=document.querySelector(".content"),S=y.querySelector(".places__list"),C=y.querySelector(".profile__edit-button"),h=y.querySelector(".profile__add-button"),b=y.querySelector(".profile__id"),q=y.querySelector(".profile__title"),E=y.querySelector(".profile__description"),L=y.querySelector(".profile__image"),g=document.querySelector(".popup_type_edit"),x=document.querySelector(".popup_type_edit-avatar"),k=document.querySelector(".popup_type_new-card"),B=document.querySelector(".popup_type_delete-card"),A=document.querySelector(".popup_type_image"),I=A.querySelector(".popup__image"),w=A.querySelector(".popup__caption"),P=document.forms["edit-profile"],T=document.forms["edit-avatar"],D=document.forms["remove-place"],N=document.forms["new-place"],O={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function j(t){!function(t,e){t.classList.add("popup__is-validating"),function(t,e){t.dataset.validationFormSelector=e.formSelector,t.dataset.validationInputSelector=e.inputSelector,t.dataset.validationSubmitButtonSelector=e.submitButtonSelector,t.dataset.validationInactiveButtonClass=e.inactiveButtonClass,t.dataset.validationInputErrorClass=e.inputErrorClass,t.dataset.validationErrorClass=e.errorClass}(t,e);var n=t.querySelector(e.formSelector),i=Array.from(n.querySelectorAll(e.inputSelector));o(n,e),i.forEach((function(t){r(n,t,e),t.addEventListener("input",a)}))}(t,O),e(t)}function F(t){var e=t.target.closest(".card");D.elements["card-id"].value=u(e),j(B)}function J(t){var n=t.target.closest(".card"),r=n.querySelector(".card__image"),o=n.querySelector(".card__title");I.src=r.src,I.alt=r.alt,w.textContent=o.textContent,e(A)}function M(t){var e,n,r,o=t.target.closest(".card");e=u(o),n=!function(t){return null!==t.querySelector(".card__like-button_is-active")}(o),r=function(t){return l(o,t,b.textContent)},fetch(d+"/likes/"+e,{method:n?"PUT":"DELETE",headers:p}).then(v).then(r).catch(m)}document.addEventListener("click",(function(t){t.target.classList.contains("popup__close")?n(t.target.closest(".popup")):t.target.classList.contains("popup")&&n(t.target)})),document.addEventListener("closePopup",(function(t){t.target.classList.contains("popup__is-validating")&&function(t){var e=i(t);t.classList.remove("popup__is-validating");var n=t.querySelector(e.formSelector);Array.from(n.querySelectorAll(e.inputSelector)).forEach((function(t){return t.removeEventListener("input",a)})),function(t){delete t.dataset.validationFormSelector,delete t.dataset.validationInputSelector,delete t.dataset.validationSubmitButtonSelector,delete t.dataset.validationInactiveButtonClass,delete t.dataset.validationInputErrorClass,delete t.dataset.validationErrorClass}(t),n.reset()}(t.target)})),C.addEventListener("click",(function(t){P.elements.name.value=q.textContent,P.elements.description.value=E.textContent,j(g)})),L.addEventListener("click",(function(t){var e=L.style["background-image"];/^URL\([\"\'].+[\"\']\)$/i.test(e)&&(T.elements.link.value=e.slice(5,e.length-2)),j(x)})),h.addEventListener("click",(function(t){j(k)})),P.addEventListener("submit",(function(t){t.preventDefault();var e,r,o,a,i=P.submit.textContent;P.submit.textContent="Сохранение...",e=P.elements.name.value,r=P.elements.description.value,o=function(t,e){q.textContent=t,E.textContent=e},a=function(){n(g),P.submit.textContent=i},fetch(s,{method:"PATCH",headers:p,body:JSON.stringify({name:e,about:r})}).then(v).then((function(t){return o(t.name,t.about)})).catch(m).finally(a)})),T.addEventListener("submit",(function(t){t.preventDefault();var e,r,o,a=T.submit.textContent;T.submit.textContent="Сохранение...",e=T.elements.link.value,r=function(t){L.style["background-image"]='url("'+t+'")'},o=function(){n(x),T.submit.textContent=a},fetch(s+"/avatar",{method:"PATCH",headers:p,body:JSON.stringify({avatar:e})}).then(v).then((function(t){return r(t.avatar)})).catch(m).finally(o)})),D.addEventListener("submit",(function(t){t.preventDefault();var e,r,o,a=D.submit.textContent;D.submit.textContent="Удаление...",e=D.elements["card-id"].value,r=function(t){var e=document.querySelectorAll(".card"),n=Array.from(e).find((function(e){return u(e)===t}));n&&n.remove()},o=function(){n(B),D.submit.textContent=a},fetch(d+"/"+e,{method:"DELETE",headers:p}).then(v).then((function(){return r(e)})).catch(m).finally(o)})),N.addEventListener("submit",(function(t){t.preventDefault();var e,r,o,a,i=N.submit.textContent;N.submit.textContent="Добавление...",e=N.elements["place-name"].value,r=N.elements.link.value,o=function(t){var e=c(t,J,F,M);l(e,t,b.textContent),S.prepend(e)},a=function(){n(k),N.submit.textContent=i},fetch(d,{method:"POST",headers:p,body:JSON.stringify({name:e,link:r})}).then(v).then(o).catch(m).finally(a)})),Promise.all([(_=function(t){b.textContent=t._id,q.textContent=t.name,E.textContent=t.about,L.style["background-image"]="url(".concat(t.avatar,")")},fetch(s,{headers:p}).then(v).then(_).catch(m)),f((function(t){return t}))]).then((function(t){t[1].forEach((function(t){var e=c(t,J,b.textContent===t.owner._id?F:null,M);l(e,t,b.textContent),S.append(e)}))})).catch(m)})();